<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boa.cashfilm.mapper.memberMapper">
	<!-- 회원 정보 조회 -->
	<select id="selectMemberInfo" parameterType="String" resultType="com.boa.cashfilm.member.dto.MemberInfo">
		SELECT
			e.memberEmail
			, e.memberName
			, d.memberPhoneFirst
			, d.memberPhoneSecond
			, d.memberPostalCode
			, d.memberAddress
			, d.memberPhone
			, c.memberClassificationName
			, b.comName
		FROM cfmemberemail AS e 
		LEFT JOIN cfmemberdetails AS d
		ON e.memberEmail = d.memberEmail
		LEFT JOIN cfmemberclassification AS c
		ON e.memberClassificationCode = c.memberClassificationCode
		LEFT JOIN cfcombaseinfo AS b
		ON e.comCode = b.comCode
		WHERE e.memberEmail = #{memberEmail}
	</select>

	<!-- 회원가입 상세 처리 -->
	<insert id="insertSignUpDetails" parameterType="com.boa.cashfilm.member.dto.MemberSignUp">
		INSERT INTO cfmemberdetails (
			memberEmail
			, memberPhoneFirst
			, memberPhoneSecond
			, memberPostalCode
			, memberAddress
			, memberCertification
			, memberPhone
			, memberSignDay
		) VALUES (
			#{memberEmail}
			, #{memberPhoneFirst}
			, #{memberPhoneSecond}
			, #{memberPostalCode}
			, #{memberAddress}
			, #{memberCertification}
			, #{memberPhone}
			, NOW()
		)
	</insert>

	<!-- 회원가입 간단 처리 -->
	<insert id="insertSignUpSimple" parameterType="com.boa.cashfilm.member.dto.MemberSignUp">
		INSERT INTO cfmemberemail (
			memberEmail
			, memberClassificationCode
			, memberName
			, memberPassword
			, memberCondition
		) VALUES (
			#{memberEmail}
			, 3
			, #{memberName}
			, #{memberPassword}
			, '활동'
		)
	</insert>
	
	<!-- 이메일 중복 검사 -->
	<select id="selectEmailOverlap" parameterType="String" resultType="int">
		SELECT COUNT(memberEmail)
		FROM cfmemberemail
		WHERE memberEmail = #{memberEmail}
	</select>
	
	<!-- 로그인 처리 -->
	<select id="selectSignIn" parameterType="com.boa.cashfilm.member.dto.EmailAndPassword" resultType="com.boa.cashfilm.member.dto.MemberSimple">
		SELECT
			memberEmail
			, memberClassificationCode
			, comCode
			, memberName
			, memberPassword
			, memberCondition
		FROM cfmemberemail
		WHERE memberEmail = #{memberEmail} AND memberPassword = #{memberPassword}
	</select>
</mapper>